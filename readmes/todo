############################################################

V1 Specification, user stories, etc:
√ Log in
√ Log out
√ Schedule push to all
√ View messages and status
X View details of a message and remove/cancel a message
X View users / registered devices/tokens
X View administrators
X Client framework for server communication


Future specifications:
X Group users into different groups
X View user groups / filter users on groups/attributes
X Send push to specific user groups (A notification_template has receivers? (i.e. list of DeviceId))
X View receivers of a notification_template (add a section in the /view/message template)
X Geolocation
X Send push to users at certain locations


############################################################

Backend:

Mobile Client API:
√ /gcm/registerToken:
√ /gcm/unRegisterToken:


Web Client API:
√ /auth/login
√ /auth/logout

X /push/new_message POST:
√ 0) Validate input and populate template with errors in case of error
X When invalid input, return which field is refers to
X When invalid input, return already entered data in order to pre-populate fields

X Misc) 
√ Allow admin to select a scheduled for date in /push/new_message UI
√ Persist a notification_template when administrator creates a message in the web UI (and update appropriate fields, such as ScheduledFor, Title, Body, Etc) 
√ Create 'view notifications' template (ability to filter on all, unsent, and sent)
√ Click on a notification template to see sent messages

X Remove/Cancel a scheduled notification_template
X Update lucid chart
X Update apiary

X Live update of sent notifications in 'push/view_messages' when a message is sent
X Move notification_scheduler into src, and invoke it from init?
X Write tests!!!



############################################################

Frontend:

Web Client:

/push/new_message
X Disable 'create' button if no input is entered
X Pre populate fields with previous input

############################################################

MISC:

Todo:
X cb_admin 

Refactor:
X Change format {atom, {{}, {}}}, to {atom, [{},{}]} 
X Replace deprecated method erlang:now/0 with erlang:timestamp/0

Tests
X Fix tests that failed after login
X Eunit Test admin, auth_lib, session_lib, device_service, ,
X Functional Test push_controller, auth_controller, lost_controller

X How localize web client?

############################################################

- Mobile client framework:
  - clientId,
  - deviceString
  - iOSVersion
  - frameworkVersion?
  - gcmToken
   
- Server user model:
  - Id
  - clientId
  - deviceString
  - frameworkVersion
  - gcmToken






############################################################
#
Notification scheduling:
- A device has many notifications (that have been received)
- A notification_template has many notifications (that have been sent), and a creater (AdminId)
- A notification has one device (the receiver) and one template (the contents, etc)


1) Admin creates a new notification template through the web UI, containing title, body, scheduledFor
2) A bg-timer checks for notification_templates that have not been sent and whos scheuledFor has passed.
2.2) For each found notification, update 'sentAt' and send them.
2.3) Upon receiving response, persist a 'notification' object, tied to the 'notification_template', and to the receiving 'device'. 
The 'notification' object also contains status, (TODO: add send timestamp?).

When parsing the response: 
- mark invalid tokens as removed
- update old tokens if we receive new


FUTURE:
- A notification_template has receivers? (i.e. list of DeviceId)
